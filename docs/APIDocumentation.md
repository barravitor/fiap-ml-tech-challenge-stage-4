# ðŸ“˜ API Documentation

This document describes the available API routes, how to use them correctly, and the expected format of requests and responses.

## Table of Contents

- [Health Check Routes](#health-check-routes)
- [Stock Prediction Routes](#stock-prediction-routes)
- [Error Handling](#error-handling)
- [JSON Request Example with CSV](#json-request-example-with-csv)

---

## Health Check Routes

### `GET /health`

Checks if the API is online.

#### Response

```json
{
  "status": "ok"
}
```

---

## Stock Prediction Routes

### `POST /predict/stocks`

Sends a sequence of stock data in CSV format to predict the next closing value.

#### Request Body

```json
{
  "ticker": "PETR4.SA",
  "csv": "Date,Close,High,Low,Open,Volume\n2025-04-16,29.40438461303711,29.850192373609328,29.262105694486365,29.679458756853204,73227700\n2025-04-17,29.947561264038086,30.267907870524713,29.568968473423748,29.772826414762847,65752700\n2025-04-22,30.015514373779297,30.335860991790444,29.44277317012997,29.899023852887055,41683900\n..."
}
```

- `ticker`: Stock ticker symbol (e.g., `"PETR4.SA"`).
- `csv`: String containing the CSV data in the proper format.

#### Expected CSV Format

```
Date,Open,High,Low,Close,Volume
2025-04-16,29.40,29.85,29.26,29.67,73227700
2025-04-17,29.94,30.26,29.56,29.77,65752700
...
```

---

#### Successful Response (`200 OK`)

```json
{
  "predictions": [31.12],
  "data": [
    {
      "Close": 31.11992073059082,
      "High": 32.03924146833904,
      "Volume": 20776200.0,
      "SMA_10": 31.63815269470215,
      "RSI_14": 31.14500599404569,
      "Volume_MA_10": 38548940.0,
      "Volume_Relative": 0.5389564537961355
    }
  ]
}
```

---

## Error Handling

The API returns the following errors in specific cases:

### `400 Bad Request`

- Erro ao ler o CSV:
```json
{
  "detail": "Error to read CSV data"
}
```

- CSV with fewer rows than required:
```json
{
  "detail": "CSV report must have at least 30 rows"
}
```

- CSV with incorrect columns:
```json
{
  "detail": "CSV data must be 6 columns"
}
```

### `500 Internal Server Error`

```json
{
  "detail": "Internal error server"
}
```

---

## JSON Request Example with CSV

```json
{
  "ticker": "PETR4.SA",
  "csv": "Date,Close,High,Low,Open,Volume\n2025-04-08,30.35291290283203,32.19305694496052,30.23908868340959,31.96541212446482,62128500\n2025-04-09,31.586000442504883,31.85159090077608,29.442327480958316,29.69842881814375,106391600\n2025-04-10,29.62254524230957,31.32041216133634,29.594090544584265,31.30144115673642,71250600\n2025-04-11,30.210634231567383,30.63747098723623,29.195708987578058,29.878648882152984,65329400\n2025-04-14,30.09680938720703,31.187618628263053,29.821737058258027,30.92202818322861,56015200\n2025-04-15,29.40438461303711,30.229605235310785,29.385413608117116,30.09681001004543,58276900\n2025-04-16,29.40438461303711,29.850192373609328,29.262105694486365,29.679458756853204,73227700\n2025-04-17,29.947561264038086,30.267907870524713,29.568968473423748,29.772826414762847,65752700\n2025-04-22,30.015514373779297,30.335860991790444,29.44277317012997,29.899023852887055,41683900\n2025-04-23,29.675752639770508,30.85035815124014,29.607800606757742,30.432936403814253,71566500\n2025-04-24,29.53984832763672,29.93785467615614,29.18067091842079,29.908731583013004,61589200\n2025-04-25,29.627214431762695,29.83107051999426,29.316575524998065,29.452479583819105,35581500\n2025-04-28,29.510725021362305,29.87961012562846,29.365113259806296,29.66604448056258,27362000\n2025-04-29,29.666044235229492,29.90873111966719,29.26803789287598,29.413649653227804,33041100\n2025-04-30,29.11271858215332,29.68545978044638,29.083595489314114,29.52043262413221,52798300\n2025-05-02,29.90873146057129,29.90873146057129,29.093303371441927,29.316576714850545,33146600\n2025-05-05,28.79237174987793,29.724290346606505,28.79237174987793,29.67575185890742,59011700\n2025-05-06,29.268037796020508,29.501016982123236,29.083595246023105,29.229208857447045,52751300\n2025-05-07,29.40394401550293,29.41364986158168,29.02535121404161,29.41364986158168,35050400\n2025-05-08,29.811655044555664,30.12229580203148,29.55926232215958,29.695166380611923,44665000\n2025-05-09,30.00580596923828,30.267908246406055,29.743703692070508,30.19024851815864,25075600\n2025-05-12,30.724159240722656,31.22894655384928,30.724159240722656,30.96684612548595,53493600\n2025-05-13,31.19011878967285,31.30660745496063,30.432935059086475,30.840649090701607,56165300\n2025-05-14,30.976552963256836,31.180409052053722,30.77269687445995,31.063920387470912,28060100\n2025-05-15,30.937725067138672,31.151288860433016,30.665915088038055,30.772697910462227,32468300\n2025-05-16,31.083335876464844,31.219239936075414,30.733866178547434,30.90860102750614,48111800\n2025-05-19,31.044506072998047,31.160994741633885,30.772697945145083,30.908602009071565,30200500\n2025-05-20,31.170703887939453,31.46192740731888,31.015384430729895,31.112457702820386,33485800\n2025-05-21,30.82123374938965,31.442511569478505,30.762989416644807,31.267776719690026,28724100\n2025-05-22,30.41352081298828,30.72415973422627,30.297030291747028,30.71445203649333,42207300\n2025-05-23,30.48147201538086,30.48147201538086,29.96697701042583,30.18054080007188,25732400\n2025-05-26,30.384397506713867,30.607670849897698,30.22907804718408,30.539716966243656,21277100\n2025-05-27,30.607669830322266,30.743573889995215,30.44264267862485,30.597962132980776,34361500\n2025-05-28,30.510595321655273,30.792111144000494,30.510595321655273,30.74357450787152,30516200\n2025-05-29,30.326152801513672,30.578547383052328,30.14171025124427,30.559131987959972,20778800\n2025-05-30,29.996097564697266,30.355274956596304,29.996097564697266,30.238784441194095,45127700\n2025-06-02,30.170833587646484,30.724159391371266,30.102881555828212,30.714451693746653,35111000\n2025-06-03,30.18000030517578,30.299999237060547,29.389999389648438,29.8799991607666,59828700\n2025-06-04,29.350000381469727,30.450000762939453,29.270000457763672,30.239999771118164,41952900\n2025-06-05,29.360000610351562,29.639999389648438,29.209999084472656,29.5,23774000\n2025-06-06,29.670000076293945,29.829999923706055,29.360000610351562,29.450000762939453,28069300"
}
```

---

## Notes

- The CSV must contain **at least 30 rows** for calculations of indicators like SMA and RSI to be valid.
- The `ticker` field is used only for control and traceability.

---
